#!/usr/bin/env bash

set -euo pipefail

WGX_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
# shellcheck source=lib/parse_yaml.sh
source "${WGX_ROOT}/lib/parse_yaml.sh"
# shellcheck source=lib/logging.bash
source "${WGX_ROOT}/lib/logging.bash"

log_info "Bootstrapping development environment..."

if [ -f pyproject.toml ] && command -v uv >/dev/null 2>&1; then
  log_info "Found pyproject.toml, running uv sync..."
  uv sync --extra test
fi

if [ -f Cargo.toml ] && command -v cargo >/dev/null 2>&1; then
  log_info "Found Cargo.toml, checking for dependencies..."
  cargo fetch
  if ! command -v cargo-llvm-cov >/dev/null 2>&1; then
    log_info "Installing cargo-llvm-cov..."
    cargo install cargo-llvm-cov
  fi
fi

log_info "Bootstrap complete."
