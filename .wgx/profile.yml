class: python-service

tasks:
  smoke: |
    set -euo pipefail
    echo "[wgx.smoke] semantAH"
    if [ -f pyproject.toml ]; then
      uv run python -m compileall semantah || true
    fi

  guard: |
    set -euo pipefail
    if [ -f pyproject.toml ] && command -v uv >/dev/null 2>&1; then
      uv run ruff check .
      uv run ruff format --check .
    fi

  metrics: |
    if [ -f pyproject.toml ] && command -v uv >/dev/null 2>&1; then
      uv run pytest --cov=semantah --cov-report=xml:coverage.xml || true
    else
      echo "no metrics; skipping"
    fi

  snapshot: |
    set -euo pipefail
    echo "[wgx.snapshot] full pipeline"
    uv run pytest -q
    uv run python scripts/build_index.py
    uv run python scripts/build_graph.py
    uv run python scripts/update_related.py

  knowledge: |
    set -euo pipefail
    echo "[wgx.knowledge] not yet implemented â€“ skipping"
    exit 0
